{% extends "base.html" %}

{% block titulo_conteudo %} Detalhes do Pedido #{{ pedido.id }} {% endblock titulo_conteudo %}

{% block conteudo %} 

<div class="card mb-3">
    <div class="card-body">
        <p><strong>Cliente:</strong> {{ pedido.cliente.nome }}</p>
        <p><strong>Data do Pedido:</strong> {{ pedido.data_pedidof }}</p>
        <p><strong>Status:</strong> {{ pedido.get_status_display }}</p>
        <h4 class="mt-3">Total do Pedido: R$ {{ pedido.total }}</h4>
    </div>
</div>

<hr>

<h5>{% if editando %}Editar Produto{% else %}Adicionar Produto{% endif %}</h5>

<form method="POST" class="mb-4">
    {% csrf_token %}
    
    {% if not editando %}
    <div class="mb-3">
        <label for="id_produto_nome" class="form-label">Produto:</label>    
        <input type="text" class="form-control autocomplete" 
                id="id_produto_nome" 
                data-url="{% url 'buscar_dados' 'home.Produto' %}" 
                value="{{item_pedido.produto.nome}}" 
                data-hidden="#id_produto" 
                placeholder="Digite o nome do produto...">
    </div>
    {% else %}
    <div class="mb-3">
        <label class="form-label">Produto:</label>
        <input type="text" class="form-control" value="{{ form.instance.produto.nome }}" disabled>
        {{ form.produto }} 
    </div>
    {% endif %}

    {{ form.qtde.label_tag }}
    {{ form.qtde }}
    
    {{ form.pedido }}
    {% if not editando %} {{ form.produto }} {% endif %}
    
    <div class="mt-3">
        <button type="submit" class="btn btn-primary btn-sm">
            {% if editando %}Atualizar Item{% else %}Salvar Produto{% endif %}
        </button>
        
        {% if editando %}
            <a href="{% url 'detalhes_pedido' pedido.id %}" class="btn btn-secondary btn-sm">Cancelar Edição</a>
        {% else %}
            <button type="button" class="btn btn-secondary btn-sm">Registrar Pagamento</button>
            <a href="{% url 'pedido' %}" class="btn btn-secondary btn-sm">Voltar</a>
        {% endif %}
    </div>
</form>

<hr>

<h5>Itens do Pedido</h5>
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Produto</th>
            <th>Quantidade</th>
            <th>Preço Unitário (R$)</th>
            <th>Total (R$)</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for item in pedido.itempedido_set.all %}
        <tr {% if item.id == item_pedido.id %}class="table-warning"{% endif %}>
            <td>{{ item.produto.nome }}</td>
            <td>{{ item.qtde }}</td>
            <td>{{ item.preco }}</td>
            <td>{{ item.total }}</td> <td>
              <a href="{% url 'editar_item_pedido' item.id %}" class="btn btn-warning btn-sm">Editar</a>
              <a href="{% url 'remover_item_pedido' item.id %}" class="btn btn-danger btn-sm" 
              onclick="return confirm('Tem certeza que deseja remover este item? O estoque será devolvido.');">Remover</a>
            </td>         
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="text-center">Nenhum item adicionado a este pedido.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock conteudo %}