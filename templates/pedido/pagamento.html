{% extends "base.html" %}

{% block titulo_conteudo %} Registro de Pagamento - Pedido #{{ pedido.id }} {% endblock titulo_conteudo %}

{% block conteudo %} 

<div class="row mb-3">
    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-body text-center">
                <h6 class="card-title">Total do Pedido</h6>
                <h4>R$ {{ pedido.total }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h6 class="card-title">Total Pago</h6>
                <h4>R$ {{ pedido.total_pago }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-danger text-white">
            <div class="card-body text-center">
                <h6 class="card-title">Débito Restante</h6>
                <h4>R$ {{ pedido.debito }}</h4>
            </div>
        </div>
    </div>
</div>

<div class="card mb-3">
    <div class="card-body">
        <p><strong>Cliente:</strong> {{ pedido.cliente.nome }}</p>
        <p><strong>Data:</strong> {{ pedido.data_pedidof }}</p>
    </div>
</div>

<form method="post" class="mb-4">
    {% csrf_token %}    
    {{ form.as_p }}
    <button class="btn btn-primary btn-sm" type="submit">Salvar Pagamento</button>
    <a href="{% url 'detalhes_pedido' pedido.id %}" class="btn btn-secondary btn-sm">Voltar para Detalhes</a>
</form>

<hr>

<h5>Histórico de Pagamentos</h5>
<table class="table table-hover table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Valor (R$)</th>
      <th>Forma</th>
      <th>Data</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
  {% for pagamento in pedido.pagamentos %}
    <tr>
      <td>{{ pagamento.id }}</td>
      <td>{{ pagamento.valor }}</td>
      <td>{{ pagamento.get_forma_display }}</td>
      <td>{{ pagamento.data_pgtof }}</td>
      <td>
        <a href="{% url 'remover_pagamento' pagamento.id %}" class="btn btn-danger btn-sm" 
        onclick="return confirm('Tem certeza que deseja remover este pagamento?');">Excluir</a>
      </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="5" class="text-center">Nenhum pagamento registrado.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock conteudo %}